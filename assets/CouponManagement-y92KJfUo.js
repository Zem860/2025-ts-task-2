import{a as V,d as U,u as $,r as m,c as L,o as T,b as P,w as E,e as C,f as M,g as e,t as r,i as _,v as y,j as S,q as R,m as A,F as w,n as B,p as j}from"./index-CHJOHpuz.js";import{M as z,_ as N}from"./DeleteModal.vue_vue_type_script_setup_true_lang-ZKv9KzXr.js";const F="https://vue3-course-api.hexschool.io",k="buch",b=V.create({baseURL:F});b.interceptors.request.use(s=>{const i=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");return i&&(s.headers.Authorization=i),s});b.interceptors.response.use(s=>Promise.resolve(s),s=>Promise.reject(s.response.data));const q=s=>b.get(`/v2/api/${k}/admin/coupons`,{params:s}),G=s=>b.post(`/v2/api/${k}/admin/coupon`,{data:s}),H=s=>{const{id:i,data:v}=s;return b.put(`/v2/api/${k}/admin/coupon/${i}`,{data:v})},I=s=>b.delete(`/v2/api/${k}/admin/coupon/${s}`),W={class:"modal-dialog modal-dialog-centered"},J={class:"modal-content rounded-lg"},K={class:"modal-header"},O={class:"modal-title",id:"couponModalLabel"},Q={class:"modal-body"},X={class:"mb-3"},Y={class:"mb-3"},Z={class:"mb-3"},D={class:"mb-3"},ee={class:"mb-3 d-flex align-items-center"},te={class:"form-check form-switch"},oe={class:"modal-footer"},le=["disabled"],ne=U({__name:"CouponModal",props:{coupon:{}},emits:["save-coupon"],setup(s,{expose:i,emit:v}){const u=s,g=v,c=$("modalRef");let a=null;const n=m({id:"",code:"",title:"",percent:0,is_enabled:1,due_date:0,num:0}),h=L(()=>!!u.coupon.id),p=m(!1);T(()=>{c.value&&(a=new z(c.value))}),P(()=>{a&&a.dispose()}),E(()=>u.coupon,l=>{l.id&&(n.value={...l})},{immediate:!0,deep:!0});const x=()=>{a&&a.show()},f=()=>{a&&a.hide()},o=async()=>{if(!n.value.code||!n.value.title){alert("請填寫優惠券代碼和名稱");return}if(n.value.percent<0||n.value.percent>100){alert("折扣必須在 0-100 之間");return}p.value=!0;try{g("save-coupon",n.value),f()}catch{alert("保存優惠券失敗")}finally{p.value=!1}};return i({openModal:x,closeModal:f}),(l,t)=>(M(),C("div",{ref_key:"modalRef",ref:c,class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},[e("div",W,[e("div",J,[e("div",K,[e("h5",O,r(h.value?"編輯優惠券":"新增優惠券"),1),t[5]||(t[5]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",Q,[e("form",null,[e("div",X,[t[6]||(t[6]=e("label",{for:"couponCode",class:"form-label"},"優惠券代碼",-1)),_(e("input",{"onUpdate:modelValue":t[0]||(t[0]=d=>n.value.code=d),type:"text",class:"form-control rounded-lg",id:"couponCode",placeholder:"例: SUMMER20"},null,512),[[y,n.value.code]])]),e("div",Y,[t[7]||(t[7]=e("label",{for:"couponTitle",class:"form-label"},"優惠券名稱",-1)),_(e("input",{"onUpdate:modelValue":t[1]||(t[1]=d=>n.value.title=d),type:"text",class:"form-control rounded-lg",id:"couponTitle",placeholder:"例: 暑期優惠"},null,512),[[y,n.value.title]])]),e("div",Z,[t[8]||(t[8]=e("label",{for:"couponPercent",class:"form-label"},"折扣 (%)",-1)),_(e("input",{"onUpdate:modelValue":t[2]||(t[2]=d=>n.value.percent=d),type:"number",class:"form-control rounded-lg",id:"couponPercent",min:"0",max:"100",placeholder:"例: 20"},null,512),[[y,n.value.percent,void 0,{number:!0}]])]),e("div",D,[t[9]||(t[9]=e("label",{for:"couponDueDate",class:"form-label"},"到期日期",-1)),_(e("input",{"onUpdate:modelValue":t[3]||(t[3]=d=>n.value.due_date=d),type:"number",class:"form-control rounded-lg",id:"couponDueDate",placeholder:"Unix 時間戳"},null,512),[[y,n.value.due_date,void 0,{number:!0}]])]),e("div",ee,[t[10]||(t[10]=e("label",{class:"form-label me-3 mb-0"},"啟用",-1)),e("div",te,[_(e("input",{"onUpdate:modelValue":t[4]||(t[4]=d=>n.value.is_enabled=d),class:"form-check-input",type:"checkbox",id:"couponEnabled","true-value":1,"false-value":0},null,512),[[S,n.value.is_enabled]])])])])]),e("div",oe,[e("button",{onClick:f,type:"button",class:"btn btn-outline-secondary rounded-lg"}," 取消 "),e("button",{onClick:o,disabled:p.value,type:"button",class:"btn btn-dark rounded-lg"},r(p.value?"儲存中...":"儲存"),9,le)])])])],512))}}),se={class:"d-flex justify-content-end align-items-center mb-4"},ae={class:"card shadow-sm rounded-lg"},de={class:"card-body p-4"},ie={class:"table table-hover"},re=["onClick"],ue=["onClick"],me=U({__name:"CouponManagement",setup(s){const i=m([]),v=m({total_pages:0,current_page:0,has_pre:!1,has_next:!1,category:""}),u=m("1"),g=$("couponModalRef"),c=$("deleteModalRef"),a=m({id:"",code:"",title:"",percent:0,is_enabled:1,due_date:0,num:0}),n=async(o="1")=>{try{const l=await q({page:o});i.value=l.data.coupons,v.value=l.data.pagination}catch(l){console.error("取得優惠券失敗:",l),alert("取得優惠券失敗")}},h=(o=null)=>{o?a.value={...o}:a.value={id:"",code:"",title:"",percent:0,is_enabled:1,due_date:0,num:0},g.value?.openModal()},p=o=>{c.value?.openModal(()=>x(o))},x=async o=>{try{await I(o),n(u.value)}catch(l){console.error("刪除優惠券失敗:",l),alert("刪除優惠券失敗")}},f=async o=>{try{o.id?await H({id:o.id,data:{code:o.code,title:o.title,percent:o.percent,is_enabled:o.is_enabled,due_date:o.due_date}}):await G({code:o.code,title:o.title,percent:o.percent,is_enabled:o.is_enabled,due_date:o.due_date}),n(u.value)}catch(l){console.error("保存優惠券失敗:",l),alert("保存優惠券失敗")}};return T(async()=>{await n(u.value)}),(o,l)=>(M(),C(w,null,[e("div",se,[e("button",{onClick:l[0]||(l[0]=t=>h(null)),type:"button",class:"btn btn-dark rounded-lg px-4 py-2"},[...l[1]||(l[1]=[e("i",{class:"fas fa-plus me-2"},null,-1),A("新增優惠券 ",-1)])])]),e("div",ae,[e("div",de,[l[3]||(l[3]=e("h4",{class:"mb-4"},"優惠券管理",-1)),e("table",ie,[l[2]||(l[2]=e("thead",null,[e("tr",null,[e("th",null,"優惠券代碼"),e("th",null,"優惠券名稱"),e("th",null,"折扣"),e("th",null,"到期日期"),e("th",null,"啟用狀態"),e("th",null,"操作")])],-1)),e("tbody",null,[(M(!0),C(w,null,B(i.value,t=>(M(),C("tr",{key:t.id},[e("td",null,r(t.code),1),e("td",null,r(t.title),1),e("td",null,r(t.percent)+"%",1),e("td",null,r(new Date(t.due_date*1e3).toLocaleDateString("zh-TW")),1),e("td",null,[e("span",{class:j({"badge bg-success":t.is_enabled===1,"badge bg-danger":t.is_enabled===0})},r(t.is_enabled===1?"啟用":"停用"),3)]),e("td",null,[e("button",{onClick:d=>h(t),class:"btn btn-sm btn-outline-dark rounded-lg me-2"}," 編輯 ",8,re),e("button",{onClick:d=>p(t.id),class:"btn btn-sm btn-outline-danger rounded-lg"}," 刪除 ",8,ue)])]))),128))])])])]),R(ne,{ref_key:"couponModalRef",ref:g,coupon:a.value,onSaveCoupon:f},null,8,["coupon"]),R(N,{ref_key:"deleteModalRef",ref:c,title:"刪除優惠券",content:"確定要刪除該優惠券嗎？"},null,512)],64))}});export{me as default};
